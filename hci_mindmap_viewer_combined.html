
<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
  <title>HCI Mindmap Viewer</title>
  <style>
    body {{
      font-family: 'Helvetica Neue', Helvetica, sans-serif;
      margin: 0;
      overflow: hidden;
    }}
    .node circle {{
      fill: #fff;
      stroke: steelblue;
      stroke-width: 1.5px;
    }}
    .node text {{
      font-size: 14px;
      fill: #333;
    }}
    .link {{
      fill: none;
      stroke: #ccc;
      stroke-width: 1.5px;
    }}
    .tooltip {{
      position: absolute;
      text-align: left;
      padding: 6px;
      font-size: 13px;
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid #aaa;
      border-radius: 4px;
      pointer-events: none;
      color: #333;
    }}
  </style>
</head>
<body>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    const width = window.innerWidth;
    const height = window.innerHeight;

    const svg = d3.select("body").append("svg")
      .attr("width", width)
      .attr("height", height)
      .call(d3.zoom().on("zoom", (event) => {{
        g.attr("transform", event.transform);
      }}));

    const g = svg.append("g");

    const tree = d3.tree().size([height - 100, width - 200]);
    const stratify = d3.hierarchy;

    const tooltip = d3.select("body").append("div")
      .attr("class", "tooltip")
      .style("opacity", 0);

    d3.json("https://kkabi00.github.io/hci_mindmap_combined.json").then(data => {{
      const root = d3.hierarchy(data);
      root.x0 = height / 2;
      root.y0 = 0;

      const diagonal = d3.linkHorizontal()
        .x(d => d.y)
        .y(d => d.x);

      update(root);

      function update(source) {{
        const treeData = tree(root);
        const nodes = treeData.descendants();
        const links = treeData.links();

        nodes.forEach(d => d.y = d.depth * 200);

        const node = g.selectAll('g.node')
          .data(nodes, d => d.id || (d.id = ++i));

        const nodeEnter = node.enter().append('g')
          .attr('class', 'node')
          .attr("transform", d => `translate(${source.y0},${source.x0})`)
          .on("click", (event, d) => {{
            d.children = d.children ? null : d._children;
            update(d);
          }})
          .on("mouseover", (event, d) => {{
            tooltip.transition().duration(200).style("opacity", .9);
            tooltip.html(d.data.name)
              .style("left", (event.pageX + 10) + "px")
              .style("top", (event.pageY - 20) + "px");
          }})
          .on("mouseout", () => {{
            tooltip.transition().duration(500).style("opacity", 0);
          }});

        nodeEnter.append('circle')
          .attr('r', 5)
          .style("fill", "#fff");

        nodeEnter.append('text')
          .attr("dy", ".35em")
          .attr("x", d => d.children || d._children ? -10 : 10)
          .style("text-anchor", d => d.children || d._children ? "end" : "start")
          .text(d => d.data.name);

        const nodeUpdate = nodeEnter.merge(node);

        nodeUpdate.transition()
          .duration(300)
          .attr("transform", d => `translate(${d.y},${d.x})`);

        const link = g.selectAll('path.link')
          .data(links, d => d.target.id);

        const linkEnter = link.enter().insert('path', "g")
          .attr("class", "link")
          .attr('d', d => {{
            const o = {{ x: source.x0, y: source.y0 }};
            return diagonal({{ source: o, target: o }});
          }});

        const linkUpdate = linkEnter.merge(link);

        linkUpdate.transition()
          .duration(300)
          .attr('d', d => diagonal(d));

        nodes.forEach(d => {{
          d.x0 = d.x;
          d.y0 = d.y;
          if (d.children) d._children = d.children;
        }});
      }}
    }});
  </script>
</body>
</html>
